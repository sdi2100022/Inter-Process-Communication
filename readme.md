# Κ24 - Systems Programming Prj1
## Inter Process Communication (IPC)

### Author : Αθανάσιος Γιαβρίδης 

## Σχεδιαστικές Επιλογές
 
#### jobCommander.c
- Signal Handler : `signal_handler(int signum)`: Αντιμετωπίζει το σήμα `SIGUSR1`, χωρίς να κάνει κάποια επιπλέον ενέργεια.
-  Ορίζεται ο τρόπος αντιμετώπισης του σήματος `SIGUSR1` με την χρήση `sigaction`.
-  Ελέγχει αν τα ορίσματα της γραμμής εντολών είναι επαρκή. Εάν όχι, εμφανίζει μήνυμα σφάλματος και τερματίζει το πρόγραμμα.
-  Ανοίγει το αρχείο του server και αν αυτό δεν υπάρχει, δημιουργεί τον διακομιστή μέσω `fork` και `execl`.
-   Ανοίγει τα pipes για ανάγνωση (`EX_TO_COM`) και εγγραφή (`COM_TO_EX`).
-   Διαβάζει το PID του server από το αρχείο του διακομιστή και το αποθηκεύει.
-   Δημιουργεί και στέλνει το μήνυμα προς τον διακομιστή μέσω των σωλήνων.
- Στέλνει το σήμα `SIGUSR2` στον server για να τον ειδοποιήσει ότι υπάρχει νέο μήνυμα.
-   Περιμένει την απάντηση από τον server χρησιμοποιώντας `pause`.
-   Διαβάζει και εμφανίζει το μήνυμα απάντησης από το pipe ανάγνωσης (`read_pd`).
#### jobExecutorServer.c
- Signal Handler : `signal_handler(int signum)`: Διαχειρίζεται τα σήματα `SIGUSR2` και `SIGCHLD`.        Όταν λαμβάνεται `SIGUSR2`, η `flag_com` τίθεται σε `true`, ενώ όταν λαμβάνεται `SIGCHLD`, η `flag_child` τίθεται σε `true` και καταγράφεται η ολοκλήρωση ενός child process.
- Ορίζεται ο τρόπος αντιμετώπισης των σημάτων `SIGUSR2` και `SIGCHLD` με τη χρήση `sigaction`.
- Δημιουργείται το αρχείο του server και τα pipes για την επικοινωνία.
-  Ο PID του διακομιστή γράφεται στο αρχείο `SERVER_FILE`.
-  Δημιουργούνται δύο ουρές για τις εργασίες σε αναμονή και για τις εκτελούμενες καθώς και για τις ολοκληρωμένες εργασίες.
- Υπάρχει ένας βρόχος που τρέχει μέχρι ο server να λάβει `exit` εντολή
-   Στην περίπτωση που λαμβάνεται `SIGUSR2` ο server διαβάζει από το pipe ανάγνωση την εντολή που θα τρέξει παίρνει το μήνυμα που θα χρειαστεί να επιστρέψει,το γράφει στο pipe συγγραφής και στέλνει `SIGUSR1` στον commander.
-  Στην περίπτωση που λαμβάνεται `SIGCHLD` ο server γνωρίζει πως πρέπει να εισάγει νέα εργασία για εκτέλεση,καθαρίζει την ουρά των ολοκληρωμένων εργασίων και τα αφαιρεί και από την ουρά των εκτελέσιμων με βάση τα pid τους και καλεί τη συνάρτηση `available_jobs` για να ελέγξει αν υπάρχει διαθέσιμος χώρος για νέες εργασίες.
- Οι εντολές είναι οι ακόλουθες:
##### jobCommands.c
1.  **Command `issueJob`**:
    
    -   Δημιουργεί μια νέα εργασία, δημιουργώντας ένα `jobtuple` και το τοποθετεί στην ουρά `queued` του server.
    -   Επιστρέφει μια συμβολοσειρά που περιέχει τις λεπτομέρειες της νέας εργασίας.
2.  **Command `setConcurrency`**:
    
    -   Ρυθμίζει την ταυτόχρονη εκτέλεση εργασιών στον server.
    -   Καλεί τη συνάρτηση `available_jobs` για να ελέγξει αν υπάρχει διαθέσιμος χώρος για νέες εργασίες.
3.  **Command `stop`**:
    
    -   Διακόπτει μια εργασία με βάση το `jobID`.
    -   Αναζητά την εργασία τόσο στην ουρά `queued` όσο και στην ουρά `running`.
    -   Επιστρέφει ένα μήνυμα που δηλώνει αν η εργασία διακόπηκε ή δεν βρέθηκε.
4.  **Command `poll`**:
    
    -   Επιστρέφει μια λίστα με τις εργασίες που βρίσκονται σε μια συγκεκριμένη κατάσταση (`running` ή `queued`).
5.  **Function `available_jobs`**:
    
    -   Ελέγχει αν υπάρχει διαθέσιμος χώρος στην ουρά `running` για να εκτελεστούν νέες εργασίες.
    -   Αν υπάρχει, μεταφέρει εργασίες από την ουρά `queued` στην ουρά `running`.
## Οδηγίες Χρήσης Εφαρμογής
### makefile
Με την εντολή **make** δημιουργείται τα εκτελέσιμα πρoγραμματά ***./jobCommander , ./jobExecutorServer***.
> make 

Επίσης με την εντολή **make clean** διαγράφονται τα εκτελέσιμα καθώς και όλα τα αντικείμενα προγράμματα.
> make clean

Υπάρχει και η εντολή **make count** για το μέτρημα των σειρών,λέξεων και χαρακτήρων σε όλα τα αρχεία

### Program Call
Καλούμε το πρόγραμμα ***./cmpcat*** με τους εξής τρόπους.

> ./jobCommander issueJob "job"
> ./jobCommander setConcurrency  N
> ./jobCommander poll [running,queued]
> ./jobCommander stop "job_XX"
> ./jobCommander exit


### Scripts
- multijobs.sh : Διαβάζει δύο αρχεία txt όπου περιέχουν εντολές Unix και καλεί ./jobCommander issueJob για κάθε μία από αυτές.
- allJobsStop.sh : Κοιτάει όλες τις διαθέσιμες εντολές του server με τις εντολές ./jobCommander poll queued/running και καλεί ./jobCommander stop για κάθε μία από αυτές.

